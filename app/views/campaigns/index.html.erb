<!-- app/views/scooters/index.html.erb -->

<div class="d-flex">
  <div class="banner-index-left">
  </div>
  <div class="banner-index-center">
    <div class="text-center d-flex flex-column justify-content-center h-100">
      <h3 class="banner-title">Fund your favorite places</h3>
      <%= form_tag campaigns_path, method: :get do %>
      <%= text_field_tag :query,
      params[:query],
      class: "search-form form-control, form-inline, text-center",
        placeholder: "Find a campaign", placeholder: "Enter category"
        %>
        <%= submit_tag "Search", class: "btn btn-dark" %>
        <% end %>
      </div>
  </div>
  <div class="banner-index-right">
  </div>
</div>

<div class="px-5 mx-2 d-flex flex-wrap justify-content-around">
  <% @campaigns.each do |campaign| %>
  <%= link_to campaign_path(campaign), class: "wrapper-link" do %>
  <div class="card-wrapper">
      <!-- investment card -->
    <div class="card-investment">
      <div class="card-user">
        <% if campaign.company.type_store == "Restaurant" %>
        <%= image_tag "restaurant.png", class:"avatar-m-square", alt: "avatar" %>
        <% elsif campaign.company.type_store == "Bar" %>
        <%= image_tag "bar.png", class:"avatar-m-square", alt: "avatar" %>
        <% else %>
        <%= image_tag "cafe.png", class:"avatar-m-square", alt: "avatar" %>
        <% end %>
      </div>
        <!-- background pic -->
        <!-- insert company.photo -->
      <% if campaign.company.photo.attached? %>
      <%= cl_image_tag campaign.company.photo.key, class: "card-pic"%>
      <% else %>
      <img class="card-pic" src="https://source.unsplash.com/1600x900/?food" class="card-img-top" alt="food-img">
      <% end %>

      <% days_left = ((campaign.expiry_date - Time.now)/86400).round(0) %>
      <% if days_left >= 2 %>
        <h5><span class="badge badge-open "> <%= days_left%> days left  </span></h5>
      <% elsif days_left = 1 %>
        <h5><span class="badge badge-open "> <%= days_left%> day left  </span></h5>
      <% else %>
        <h5 class="pb-0"> <span class="badge badge-closed ">Funded </span></h5>
      <% end %>
      <h1 class="mt-0"><%= campaign.company.name %>
      </h1>
      <p class="mb-3"><%= campaign.description %>
      </p>
      <div class="box-align mb-3">
        <h4>$ <%= number_with_delimiter(campaign.min_target, :delimiter => ',') %> target</h4>
      </div>
      <div class="target-bar mx-auto">
        <% if Investment.where(campaign_id: campaign.id).sum("amount") != 0 %>
        <% raised = Investment.where(campaign_id: campaign.id).sum("amount") %>
        <% target = campaign.min_target %>
        <% status = ((raised&.to_f/target)*100).round(1) %>
        <% end %>
        <div>
          <progress value="<%= status %>" max="100" id="progress-bar-percentage" class="progress-bar notfull">
          </progress>
        </div>
        <div class="statusbar-relative"> <p><%= status %> %</p>
        </div>
      </div>
      <div class="box-align d-flex justify-content-between">
        <div class="text-center">
          <h4>$ <%= number_with_delimiter(Investment.where(campaign_id: campaign.id).sum("amount"), :delimiter => ',') %></h4>
          <p>raised</p>
        </div>
        <div class="align-self-center" style="border: 1px solid lightgrey; height: 50px">
        </div>
        <div class="text-center">
          <h4><%= (campaign.return_rate*100) %>%</h4>
          <p>interest</p>
        </div>
        <div class="align-self-center" style="border: 1px solid lightgrey; height: 50px">
        </div>
        <div class="text-center">
          <h4><%= Investment.where(campaign_id: campaign.id).count%></h4>
          <p>investors</p>
        </div>
      </div>
      </div>
  </div>
  <% end %>
  <% end %>
</div>






